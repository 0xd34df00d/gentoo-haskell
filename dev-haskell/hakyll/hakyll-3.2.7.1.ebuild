# Copyright 1999-2012 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: $

# ebuild generated by hackport 0.2.17.9999

EAPI=4

CABAL_FEATURES="lib profile haddock hoogle hscolour"
inherit haskell-cabal

DESCRIPTION="A static website compiler library"
HOMEPAGE="http://jaspervdj.be/hakyll"
SRC_URI="http://hackage.haskell.org/packages/archive/${PN}/${PV}/${P}.tar.gz"

LICENSE="BSD"
SLOT="0"
KEYWORDS="~amd64 ~x86"
IUSE="server"

RDEPEND="=app-text/pandoc-1.9*[profile?]
		=dev-haskell/binary-0.5*[profile?]
		>=dev-haskell/blaze-html-0.4[profile?]
		<dev-haskell/blaze-html-0.6[profile?]
		>=dev-haskell/citeproc-hs-0.3.2[profile?]
		<dev-haskell/citeproc-hs-0.4[profile?]
		=dev-haskell/cryptohash-0.7*[profile?]
		>=dev-haskell/hamlet-0.10.3[profile?]
		<dev-haskell/hamlet-0.11[profile?]
		>=dev-haskell/mtl-1[profile?]
		<dev-haskell/mtl-2.1[profile?]
		>=dev-haskell/parsec-3.0[profile?]
		<dev-haskell/parsec-3.2[profile?]
		=dev-haskell/regex-base-0.93*[profile?]
		=dev-haskell/regex-tdfa-1.1*[profile?]
		>=dev-haskell/snap-core-0.6[profile?]
		<dev-haskell/snap-core-0.9[profile?]
		>=dev-haskell/snap-server-0.6[profile?]
		<dev-haskell/snap-server-0.9[profile?]
		>=dev-haskell/tagsoup-0.12.6[profile?]
		<dev-haskell/tagsoup-0.13[profile?]
		>=dev-haskell/time-1.1[profile?]
		<dev-haskell/time-1.5[profile?]
		>=dev-lang/ghc-6.12.1"
DEPEND="${RDEPEND}
		>=dev-haskell/cabal-1.8
		test? (
			=dev-haskell/hunit-1.2*
			=dev-haskell/quickcheck-2.4*
			>=dev-haskell/test-framework-0.4 <dev-haskell/test-framework-0.7
			=dev-haskell/test-framework-hunit-0.2*
			=dev-haskell/test-framework-quickcheck2-0.2*
		)"

src_prepare() {
	mkdir -p "${S}/tests/Hakyll/Core/Resource/Provider" \
		|| die "Could not create directory in tests for missing Dummy.hs"
	cp -p "${FILESDIR}/${PN}-3.2.7.0/src/Hakyll/Core/Resource/Provider/Dummy.hs" \
		"${S}/tests/Hakyll/Core/Resource/Provider/Dummy.hs" \
		|| die "Could not copy missing test Dummy.hs source file"
}

src_configure() {
	cabal_src_configure \
		$(cabal_flag server previewServer) \
		$(use test && use_enable test tests) #395351
}
